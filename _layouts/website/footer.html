<div class="ks-footer">
    <div class="ks-footer-top">
        <div class="ks-footer-group">
            <h4 class="title">产品与服务</h4>
            <ul class="content">
                <li>
                    <a href="//www.ksyun.com/proservice/cloud_server">云服务器</a>
                </li>
                <li>
                    <a href="//www.ksyun.com/proservice/database">关系型数据库</a>
                </li>
                <li>
                    <a href="#">开放型存储</a>
                </li>
                <li>
                    <a href="#">内容分发网络</a>
                </li>
                <li>
                    <a href="#">负载均衡</a>
                </li>
                <li>
                    <a href="#">缓存服务</a>
                </li>
                <li>
                    <a href="#">云物理主机</a>
                </li>
            </ul>
        </div>
        <div class="ks-footer-group">
            <h4 class="title">热门问题</h4>
            <ul class="content">
                <li>
                    <a href="#">注册账号</a>
                </li>
                <li>
                    <a href="#">产品购买</a>
                </li>
                <li>
                    <a href="#">产品开通</a>
                </li>
                <li>
                    <a href="#">云服务价格</a>
                </li>
                <li>
                    <a href="#">备案介绍</a>
                </li>
                <li>
                    <a href="#">API文档</a>
                </li>
                <li>
                    <a href="#">售后服务</a>
                </li>
            </ul>
        </div>
        <div class="ks-footer-group">
            <h4 class="title">快速入口</h4>
            <ul class="content">
                <li>
                    <a href="#">控制台</a>
                </li>
                <li>
                    <a href="#">个人中心</a>
                </li>
                <li>
                    <a href="#">帮助中心</a>
                </li>
                <li>
                    <a href="#">备案</a>
                </li>
            </ul>
        </div>
        <div class="ks-footer-group">
            <h4 class="title">关于我们</h4>
            <ul class="content">
                <li>
                    <a href="#">公司介绍</a>
                </li>
                <li>
                    <a href="#">新闻动态</a>
                </li>
                <li>
                    <a href="#">加入我们</a>
                </li>
                <li>
                    <a href="#">合作伙伴</a>
                </li>
                <li>
                    <a href="#">友情链接</a>
                </li>
            </ul>
        </div>
        <div class="ks-footer-contact">
            <h4 class="phone">
                <div class="ks-icon ks-tel-icon">400-028-9900</div>
            </h4>
            <div class="ks-qr-inner">
                <div class="ks-qr">
                    <span class="ks-qr-link current" onclick="showWechatCode();">关注微信</span>
                    <img src="//fe.ksyun.com/web/wechat.png" alt="微信二维码" class="ks-qr-img" width="150" height="180"></img>
                </div>
                <div class="ks-qr">
                    <span class="ks-qr-link" onclick="showWeiboCode()">关注微博</span>
                    <img src="//fe.ksyun.com/web/weibo.png" alt="微博二维码" class="ks-qr-img" width="150" height="180"></img>
                </div>
            </div>
        </div>
    </div>
    <div class="ks-footer-bottom">
        <div class="ks-copyright">
            ©北京金山云网络技术有限公司 2016 Ksyun All Rights Reserved Kingsoft Corp.&nbsp;&nbsp;&nbsp;&nbsp;京ICP证120829号&nbsp;&nbsp;&nbsp;&nbsp;
            <a href="#">京ICP备12032080号-2</a> &nbsp;&nbsp;&nbsp;&nbsp;
            <a href="#">京公网安备 11010802020326号</a>
        </div>
    </div>
</div>

<script>
    // matches polyfill
    this.Element && function(ElementPrototype) {
        ElementPrototype.matches = ElementPrototype.matches ||
        ElementPrototype.matchesSelector ||
        ElementPrototype.webkitMatchesSelector ||
        ElementPrototype.msMatchesSelector ||
        function(selector) {
            var node = this, nodes = (node.parentNode || node.document).querySelectorAll(selector), i = -1;
            while (nodes[++i] && nodes[i] != node);
            return !!nodes[i];
        }
    }(Element.prototype);

    // closest polyfill
    this.Element && function(ElementPrototype) {
        ElementPrototype.closest = ElementPrototype.closest ||
        function(selector) {
            var el = this;
            while (el.matches && !el.matches(selector)) el = el.parentNode;
            return el.matches ? el : null;
        }
    }(Element.prototype);

    function addClass(obj, cls) {
        var obj_class = obj.className; //获取 class 内容.
        var blank = (obj_class != '') ? ' ' : ''; //判断获取到的 class 是否为空, 如果不为空在前面加个'空格'.
        var added = obj_class + blank + cls; //组合原来的 class 和需要添加的 class.
        obj.className = added; //替换原来的 class.
    }

    function removeClass(obj, cls) {
        var obj_class = ' ' + obj.className + ' '; //获取 class 内容, 并在首尾各加一个空格.
        obj_class = obj_class.replace(/(\s+)/gi, ' '); //将多余的空字符替换成一个空格.
        var removed = obj_class.replace(' ' + cls + ' ', ' '); //在原来的 class 替换掉首尾加了空格的 class.
        removed = removed.replace(/(^\s+)|(\s+$)/g, ''); //去掉首尾空格.
        obj.className = removed; //替换原来的 class.
    }

    function hasClass(obj, cls) {
        var obj_class = obj.className; //获取 class 内容.
        var obj_class_lst = obj_class.split(/\s+/); //通过split空字符将cls转换成数组.
        var x = 0;
        for (x in obj_class_lst) {
            if (obj_class_lst[x] == cls) { //循环数组, 判断是否包含cls
                return true;
            }
        }
        return false;
    }

    function showWechatCode() {
        var obj = document.getElementsByClassName('ks-qr-link');
        if (!hasClass(obj[0], "current")) {
            addClass(obj[0], "current");
            removeClass(obj[1], "current");
        }
    }

    function showWeiboCode() {
        var obj = document.getElementsByClassName('ks-qr-link');
        if (!hasClass(obj[1], "current")) {
            addClass(obj[1], "current");
            removeClass(obj[0], "current");
        }
    }


    //var url = location.href;

    var url = location.href;
    var md5Dir = url.split('/')[3];

    var pdfLink = document.getElementsByClassName('pdflink');
    pdfLink[0].setAttribute('href','/' + md5Dir + '/_book/' + md5Dir + '.pdf');
    
    var crumbs = document.getElementsByClassName('crumbs');
    
    var crumbsNodes = [];
    var activeMenu = document.querySelector('.list-group .active');
    if(activeMenu.matches('li')){
        activeMenu = activeMenu.firstElementChild;
    }
    crumbsNodes.push({
        text : activeMenu.textContent
    })

    findParent(activeMenu);

    for (var i = crumbsNodes.length - 1; i >= 0; i--){
        crumbs[0].appendChild(crumbsLinkCreate(crumbsNodes[i].url, crumbsNodes[i].text));
    }

    function findParent (node) {
        var parent = node.closest('div.articles');  
        parent.closest('li').setAttribute("class","list-group-item active-level");
        if(parent){
            crumbsNodes.push({
                text : parent.closest('li').firstElementChild.textContent,
                url : parent.closest('li').firstElementChild.getAttribute('href')
            });
        }
    }
    
    function crumbsLinkCreate (url, text) {
        var a;
        if(url){
            a = document.createElement('a');
            a.setAttribute('href', url);
        }else{
            a = document.createElement('span');
        }
        var node = document.createTextNode('> ' + text);
        a.appendChild(node);
 
        return a;
    }
</script>